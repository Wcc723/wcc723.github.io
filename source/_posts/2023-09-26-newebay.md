---
layout: post
title: 藍新金流申請以及串接方式
category: development
tagline:
tags: [javascript, nodejs]
cssdemo: 
jsdemo:
thumbnail:
photo: https://firebasestorage.googleapis.com/v0/b/casper-de5d5.appspot.com/o/images%2Fblog%2FArtboard.jpg?alt=media&token=9382d4cd-64f3-49e1-a66d-c6c1569ac2fa
published: true
---

這是鐵人賽相關文章，影片會在活動開始後發布

藍新金流官方正式網站：[https://www.newebpay.com/](https://www.newebpay.com/)
藍新金流測試站：[https://cwww.newebpay.com/](https://cwww.newebpay.com/)
完整範例程式碼：[GitHub - Wcc723/node-ironman-sample-2023 at feature/newebpay-sample](https://github.com/Wcc723/node-ironman-sample-2023/tree/feature/newebpay-sample)

{% raw %} 
<div class="ratio ratio-16x9">
<iframe width="100%" src="https://www.youtube.com/embed/-eg-fRDWNFg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div>
{% endraw %}

申請流程及操作影片（9/26 公開）：https://youtu.be/-eg-fRDWNFg

如果是作為測試使用，請選擇藍新金流測試站。 在測試站中你會申請到開發用的專屬 key， 以下流程將會介紹 key 的申請方式。

## 申請流程

進入藍新金流的網站以後， 請選擇上方的會員中心， 在左側的商店管理中可以找到商店資料設定， 如果還沒有任何商店可以在此建立一個新的。 在下圖的範例中是已經建立好的商店。
![](https://firebasestorage.googleapis.com/v0/b/casper-de5d5.appspot.com/o/images%2Fblog%2F%E8%B2%BC%E4%B8%8A%E7%9A%84%E5%BD%B1%E5%83%8F_2023_9_17_10_24.png?alt=media&token=3df59bee-a2ea-4662-a7f3-1b0b9bcb7adc)

商店資料中往下看，可以找到串接金鑰， 請把其中的值複製下來， 並且避免流入他人手中（在下方的圖片中，我已經先把串接金鑰隱藏了）。
![](https://firebasestorage.googleapis.com/v0/b/casper-de5d5.appspot.com/o/images%2Fblog%2F95053CFE-9280-4E02-BCBF-2731AB8027CB.png?alt=media&token=60e837c6-82ed-4c96-a88a-af932ba036a9)

如果是新設立的商店，金流設定中並不會啟用信用卡支付，如果需要這些設定請另外開啟。
![](https://firebasestorage.googleapis.com/v0/b/casper-de5d5.appspot.com/o/images%2Fblog%2F88A9DC90-E4CC-406D-B1BB-4AEF28ED2A03.png?alt=media&token=661c4bbf-3bfa-4677-b98e-25bdae33750f)

## 程式碼
> 注意，要運行金流服務，請確保有可用的雲端伺服器。

當申請完以後，可以開啟以下  [儲存庫](https://github.com/Wcc723/node-ironman-sample-2023/tree/feature/newebpay-sample)， 下載後打開 `.env.sample`， 並將剛剛申請好的金鑰，按照需求填寫至 `.env.sample`，並且另存新檔為 `.env`。

```
MerchantID= # 商店 ID
HASHKEY= # 商店 HashKey
HASHIV= # 商店 HashIV
Version=2.0 # 串接程式版本，2023 年版本為 2.0

ReturnUrl= # 前端回傳網址
NotifyUrl= # 交易結果通知網址
PayGateWay=https://ccore.newebpay.com/MPG/mpg_gateway # 測試機、正式機 API 路徑
```

其中的 `ReturnUrl` 及 `NotifyUrl` 需要填寫雲端伺服器的路徑，本地端無法接收回傳資料。

接下來部署到雲端伺服器後，即可進行測試運行。